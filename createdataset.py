import pandas
import os
import numpy as np
import pandas as pd

data = pandas.read_csv(r'./dataset.csv')
label = data.iloc[0, :]
print(label)
data_dic = {}
file_name = np.array(data.iloc[:, 0]).tolist()

for i, name in enumerate(file_name):
    file_name[i] = name.split('.')[0]

# print(file_name)
file_info = np.array(data.iloc[:, 2:]).tolist()
# print(file_info)
correct_file = r'./correct'
wrong_file = r'./wrong'

correct = os.listdir(correct_file)
for c in correct:
    path = os.path.join(correct_file, c)
    with open(path, 'r', encoding='utf-8') as f:
        data = f.readlines()
        if len(data[0]) < 30:
            continue
        if len(data) > 1:
            data = ' '.join(data)

        index = 0
        c = c.split('.')[0]
        if c in file_name:
            index = file_name.index(c)
            data_dic[c] = [data[0]]
            data_dic[c].extend(file_info[index])
        else:
            print('name wrong', c)
            continue


wrong = os.listdir(wrong_file)
for w in wrong:
    name_list = w.split('.')
    file = w
    if len(name_list) == 1:
        file_name = w + '.txt'
    # print(file_name)
    with open(os.path.join(wrong_file, file), 'r', encoding='utf-8') as f:
        data = f.readlines()
        if len(data[0]) < 30:
            continue

        if len(data) > 1:
            res = ''
            for d in data:
                res += ' '.join(d.split())
            data = [res]

        index = -1
        w = w[:42]
        if w in file_name:
            index = file_name.index(w)
            # print(w, index, file_name[index])
            data_dic[w] = [data[0]]
            data_dic[w].extend(file_info[index])
        else:
            print('name wrong', w)
            continue

df = pd.DataFrame.from_dict(data_dic, orient='index')

df.to_csv('./result/train_c.csv', encoding='utf_8_sig')
# print(len(data_dic))
# for k, v in data_dic.items():
#     print(k, v[1:])